{"ast":null,"code":"import _regeneratorRuntime from\"/home/hag/www/alyra/vote_dapp/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/hag/www/alyra/vote_dapp/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import Web3 from\"web3\";var getWeb3=function getWeb3(){return new Promise(function(resolve,reject){// Wait for loading completion to avoid race conditions with web3 injection timing.\nwindow.addEventListener(\"load\",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var web3,_web,provider,_web2;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!window.ethereum){_context.next=16;break;}web3=new Web3(window.ethereum);_context.prev=2;_context.next=5;return window.ethereum.enable();case 5:// Accounts now exposed\nresolve(web3);window.ethereum.on('disconnect',function(){alert(\"il faut se connecter\");});window.ethereum.on('accountsChanged',function(){window.location.reload();});window.ethereum.on('chainChanged',function(){window.location.reload();});_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](2);reject(_context.t0);case 14:_context.next=17;break;case 16:if(window.web3){// Use Mist/MetaMask's provider.\n_web=window.web3;console.log(\"Injected web3 detected.\");resolve(_web);}// Fallback to localhost; use dev console port by default...\nelse{provider=new Web3.providers.HttpProvider(\"http://127.0.0.1:8545\");_web2=new Web3(provider);console.log(\"No web3 instance injected, using Local web3.\");resolve(_web2);}case 17:case\"end\":return _context.stop();}}},_callee,null,[[2,11]]);})));});};export default getWeb3;","map":{"version":3,"names":["Web3","getWeb3","Promise","resolve","reject","window","addEventListener","ethereum","web3","enable","on","alert","location","reload","console","log","provider","providers","HttpProvider"],"sources":["/home/hag/www/alyra/vote_dapp/client/src/getWeb3.js"],"sourcesContent":["import Web3 from \"web3\";\n\nconst getWeb3 = () =>\n  new Promise((resolve, reject) => {\n    // Wait for loading completion to avoid race conditions with web3 injection timing.\n    window.addEventListener(\"load\", async () => {\n      // Modern dapp browsers...\n      if (window.ethereum) {\n        const web3 = new Web3(window.ethereum);\n        try {\n          // Request account access if needed\n          await window.ethereum.enable();\n          // Accounts now exposed\n          resolve(web3);\n          window.ethereum.on('disconnect',function(){\n            alert(\"il faut se connecter\");\n          });\n          window.ethereum.on('accountsChanged',function(){\n            window.location.reload();\n          });     \n          window.ethereum.on('chainChanged',function(){\n            window.location.reload();\n          });\n       \n        } catch (error) {\n          reject(error);\n        }\n      }\n      // Legacy dapp browsers...\n      else if (window.web3) {\n        // Use Mist/MetaMask's provider.\n        const web3 = window.web3;\n        console.log(\"Injected web3 detected.\");\n        resolve(web3);\n      }\n      // Fallback to localhost; use dev console port by default...\n      else {\n        const provider = new Web3.providers.HttpProvider(\n          \"http://127.0.0.1:8545\"\n        );\n        const web3 = new Web3(provider);\n        console.log(\"No web3 instance injected, using Local web3.\");\n        resolve(web3);\n      }\n    });\n  });\n\nexport default getWeb3;"],"mappings":"oQAAA,MAAOA,KAAP,KAAiB,MAAjB,CAEA,GAAMC,QAAO,CAAG,QAAVA,QAAU,SACd,IAAIC,QAAJ,CAAY,SAACC,OAAD,CAAUC,MAAV,CAAqB,CAC/B;AACAC,MAAM,CAACC,gBAAP,CAAwB,MAAxB,wEAAgC,sKAE1BD,MAAM,CAACE,QAFmB,0BAGtBC,IAHsB,CAGf,GAAIR,KAAJ,CAASK,MAAM,CAACE,QAAhB,CAHe,uCAMpBF,OAAM,CAACE,QAAP,CAAgBE,MAAhB,EANoB,QAO1B;AACAN,OAAO,CAACK,IAAD,CAAP,CACAH,MAAM,CAACE,QAAP,CAAgBG,EAAhB,CAAmB,YAAnB,CAAgC,UAAU,CACxCC,KAAK,CAAC,sBAAD,CAAL,CACD,CAFD,EAGAN,MAAM,CAACE,QAAP,CAAgBG,EAAhB,CAAmB,iBAAnB,CAAqC,UAAU,CAC7CL,MAAM,CAACO,QAAP,CAAgBC,MAAhB,GACD,CAFD,EAGAR,MAAM,CAACE,QAAP,CAAgBG,EAAhB,CAAmB,cAAnB,CAAkC,UAAU,CAC1CL,MAAM,CAACO,QAAP,CAAgBC,MAAhB,GACD,CAFD,EAf0B,iFAoB1BT,MAAM,aAAN,CApB0B,uCAwBzB,GAAIC,MAAM,CAACG,IAAX,CAAiB,CACpB;AACMA,IAFc,CAEPH,MAAM,CAACG,IAFA,CAGpBM,OAAO,CAACC,GAAR,CAAY,yBAAZ,EACAZ,OAAO,CAACK,IAAD,CAAP,CACD,CACD;AANK,IAOA,CACGQ,QADH,CACc,GAAIhB,KAAI,CAACiB,SAAL,CAAeC,YAAnB,CACf,uBADe,CADd,CAIGV,KAJH,CAIU,GAAIR,KAAJ,CAASgB,QAAT,CAJV,CAKHF,OAAO,CAACC,GAAR,CAAY,8CAAZ,EACAZ,OAAO,CAACK,KAAD,CAAP,CACD,CAtC6B,qEAAhC,IAwCD,CA1CD,CADc,EAAhB,CA6CA,cAAeP,QAAf"},"metadata":{},"sourceType":"module"}